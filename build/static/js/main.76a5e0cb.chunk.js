(this.webpackJsonptrains=this.webpackJsonptrains||[]).push([[0],{202:function(e,t,a){},203:function(e,t,a){},210:function(e,t,a){},215:function(e,t,a){},216:function(e,t,a){},223:function(e,t){},225:function(e,t){},236:function(e,t){},238:function(e,t){},265:function(e,t){},267:function(e,t){},268:function(e,t){},273:function(e,t){},275:function(e,t){},281:function(e,t){},283:function(e,t){},302:function(e,t){},314:function(e,t){},317:function(e,t){},323:function(e,t,a){},324:function(e,t,a){},428:function(e,t,a){"use strict";a.r(t);var n=a(51),c=a.n(n),r=(a(202),a(203),a(20)),s=a(7),i=a(14),l=a(6),o=a(24),u=a.n(o),j=a(23),b=a(42),d=a(15),m=(a(210),a(0)),O=a(1);var h=function(){var e,t=Object(m.useState)([]),a=Object(d.a)(t,2),n=a[0],c=a[1],s=Object(m.useState)([]),o=Object(d.a)(s,2),h=o[0],x=o[1],p=Object(i.c)((function(e){return e}));Object(m.useEffect)((function(){Object(b.a)(u.a.mark((function e(){var t,a,n,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://trains-861bd-default-rtdb.firebaseio.com/trains.json");case 2:return t=e.sent,e.next=5,t.json();case 5:for(c in a=e.sent,n=[],a)n.push(Object(j.a)({trainName:c},a[c]));x(n);case 9:case"end":return e.stop()}}),e)})))()}),[]);var f=function(e){var t=Object(l.a)(n);t.includes(e)?t=t.filter((function(t){return t!==e})):t.push(e),c(Object(l.a)(t))};return Object(O.jsx)("div",{className:"makeRegistrationContainer",children:(null===(e=p[0])||void 0===e?void 0:e.train)?Object(O.jsxs)("div",{className:"selectedTrain",children:[Object(O.jsx)("p",{children:"You already chose the train"}),Object(O.jsx)("div",{className:"trainElement",children:Object(O.jsxs)(r.b,{to:"/trains/"+p[0].train,children:[Object(O.jsx)("p",{className:"trainDate",children:p[0].date}),Object(O.jsx)("p",{className:"trainName",children:p[0].train})]})})]}):Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("div",{className:"date",children:[Object(O.jsx)("p",{children:"Select a date that suits your need"}),Object(O.jsxs)("ul",{className:"daysList",children:[Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Mon")?"active":"",onClick:f.bind(null,"Mon"),children:"Mon"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Tue")?"active":"",onClick:f.bind(null,"Tue"),children:"Tue"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Wed")?"active":"",onClick:f.bind(null,"Wed"),children:"Wed"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Thu")?"active":"",onClick:f.bind(null,"Thu"),children:"Thu"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Fri")?"active":"",onClick:f.bind(null,"Fri"),children:"Fri"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Sat")?"active":"",onClick:f.bind(null,"Sat"),children:"Sat"})}),Object(O.jsx)("li",{children:Object(O.jsx)("button",{className:n.includes("Sun")?"active":"",onClick:f.bind(null,"Sun"),children:"Sun"})})]})]}),Object(O.jsx)("ul",{className:"trains",children:0===n.length?Object(O.jsx)(O.Fragment,{children:h.map((function(e){return Object(O.jsx)("li",{className:"trainElement",children:Object(O.jsxs)(r.b,{to:"/trains/"+e.trainName,children:[Object(O.jsx)("p",{className:"trainDate",children:e.date}),Object(O.jsx)("p",{className:"trainName",children:e.trainName})]})},e.trainName)}))}):Object(O.jsx)(O.Fragment,{children:h.map((function(e){return n.includes(e.date)?Object(O.jsx)("li",{className:"trainElement",children:Object(O.jsxs)(r.b,{to:"/trains/"+e.trainName,children:[Object(O.jsx)("p",{className:"trainDate",children:e.date}),Object(O.jsx)("p",{className:"trainName",children:e.trainName})]})},e.trainName):null}))})})]})})},x=(a(215),a(216),a(114)),p=a(76),f=a.n(p),v=Object(x.b)({name:"reservation",initialState:[],reducers:{addRemoveSeat:function(e,t){var a=localStorage.getItem("code");a||(a=f.a.generate(),localStorage.setItem("code",a));for(var n=!0,c=Object(l.a)(e),r=0;r<c.length;r++)if(t.payload.id===c[r].id){n=!1,c.splice(r,1);break}return n&&c.push(t.payload),0===c.length?localStorage.removeItem("seats"):localStorage.setItem("seats",JSON.stringify(Object(l.a)(c))),Object(l.a)(c)},clearStore:function(e){return localStorage.removeItem("seats"),[]},populateStore:function(e,t){return Object(l.a)(t.payload)}}}),N=v.actions,g=Object(x.a)({reducer:v.reducer}),S=N;var y=function(e){var t=Object(i.b)(),a=Object(i.c)((function(e){return e})).map((function(e){return e.id}));return e.available?Object(O.jsx)("div",{onClick:function(){var a={id:e.seatID,train:e.trainName,wagonNumber:e.wagonNumber,type:e.type,seatNumber:e.number,date:e.date};t(S.addRemoveSeat(a))},className:"seat".concat(a.includes(e.seatID)?" selected":"").concat(e.circled),children:e.number}):Object(O.jsx)("div",{className:"seat unavailable",children:e.number})};var k=function(e){var t,a=0,n=function(){for(var t=0,n=0,c=0;c<e.seats.length;c++)if(e.seats[c].available){if(++n>t&&(a=c,(t=n)===e.minimumSeats))return t}else n=0;return!1},c=function(){var e=n();return!(!e||!a)&&a-e};return""===e.minimumSeats?t="":n()<e.minimumSeats&&(t="opacityReduced"),Object(O.jsxs)("div",{className:"wagon "+e.type.replace(/ /g,"")+" "+t,children:[Object(O.jsx)("p",{className:"wagonType",children:e.type}),e.seats.map((function(t,n){return Object(O.jsx)(y,{wagonNumber:e.numberOfWagon,seatID:"".concat(e.trainName).concat(e.numberOfWagon).concat(t.seatNumber),available:t.available,number:t.seatNumber,type:e.type,date:e.date,trainName:e.trainName,circled:""!==e.minimumSeats&&!1!==c()&&n>=c()&&n<=a?" circled":""},"".concat(e.trainName).concat(e.numberOfWagon).concat(t.seatNumber))}))]})};a(323);var w=function(){var e=Object(m.useState)([]),t=Object(d.a)(e,2),a=t[0],n=t[1],c=Object(s.h)(),o=Object(m.useState)("all"),j=Object(d.a)(o,2),h=j[0],x=j[1],p=Object(m.useState)(""),f=Object(d.a)(p,2),v=f[0],N=f[1],g=Object(m.useRef)("day"),S=Object(i.c)((function(e){return e}));return Object(m.useEffect)((function(){Object(b.a)(u.a.mark((function e(){var t,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch("https://trains-861bd-default-rtdb.firebaseio.com/trains/"+c.trainID+".json");case 2:return t=e.sent,e.next=5,t.json();case 5:a=e.sent,g.current=a.date,n(Object(l.a)(a.wagons));case 8:case"end":return e.stop()}}),e)})))()}),[]),Object(O.jsxs)("div",{className:"wagonsWrapper",children:[Object(O.jsxs)("div",{className:"wagonsFilters",children:[Object(O.jsxs)("select",{onChange:function(e){x(e.target.value)},className:"wagonTypeSelector",name:"WagonType",children:[Object(O.jsx)("option",{defaultValue:!0,value:"all",children:"All"}),Object(O.jsx)("option",{value:"first class",children:"First Class"}),Object(O.jsx)("option",{value:"second class",children:"Second Class"}),Object(O.jsx)("option",{value:"sleeping",children:"Sleeping"})]}),Object(O.jsxs)("label",{className:"minimumSeatsWrapper",htmlFor:"minimumSeats",children:["Available consecutive seats:",Object(O.jsx)("input",{value:v,onChange:function(e){var t=parseInt(+e.target.value);t>=2&&t<=6?N(t):""===e.target.value&&N(e.target.value)},type:"number",id:"minimumSeats",className:"minimumSeats",min:"2",max:"6"})]})]}),Object(O.jsxs)("div",{className:"legendWrapper",children:[Object(O.jsx)("p",{children:"Seat color legend:"}),Object(O.jsxs)("div",{className:"legend",children:[Object(O.jsxs)("div",{className:"legendItem",children:[Object(O.jsx)("div",{className:"legendColor"}),"- available"]}),Object(O.jsxs)("div",{className:"legendItem",children:[Object(O.jsx)("div",{className:"legendColor unavailable"}),"- unavailable"]}),Object(O.jsxs)("div",{className:"legendItem",children:[Object(O.jsx)("div",{className:"legendColor selected"}),"- selected"]})]})]}),Object(O.jsx)("div",{className:"wagons",children:a.map((function(e,t){return"all"===h||e.type===h?Object(O.jsx)(k,{date:g.current,trainName:c.trainID,numberOfWagon:t+1,availableSeatsNumber:e.availableSeats,seats:e.seats,type:e.type,minimumSeats:v},t):void 0}))}),0===S.length?Object(O.jsx)("p",{className:"selectSeat",children:"Select a seat in order to reserve it."}):Object(O.jsx)(r.b,{className:"routerLink trainsLink",to:"/checkout",replace:!0,children:"Go to checkout >"})]})},C=(a(324),a(63)),I=a(64),T=a(8),W=["label"];var F=function(e){var t=e.label,a=Object(T.a)(e,W),n=Object(C.c)(a),c=Object(d.a)(n,2),r=c[0],s=c[1];return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("label",{htmlFor:t,children:[t,Object(O.jsx)("input",Object(j.a)(Object(j.a)({id:t},r),a))]}),s.touched&&s.error&&Object(O.jsx)("div",{className:"err",children:s.error})]})},E=a(196),D=a.n(E);var q=function(){var e=Object(i.c)((function(e){return e})),t=Object(i.b)(),a=Object(s.f)(),n=localStorage.getItem("code");n||(n=f.a.generate(),localStorage.setItem("code",n));var c=function(){var e=Object(b.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.clipboard.writeText(n);case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.error("Failed to copy: ",e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),r=function(e){t(S.addRemoveSeat({id:e}))};return 0===e.length&&a.replace("/"),Object(O.jsxs)("div",{className:"checkoutWrapper",children:[Object(O.jsx)(C.b,{initialValues:{cnp:"",name:"",email:""},validationSchema:I.a({cnp:I.b().matches(/^[0-9]+$/,"CNP must be only digits").min(13,"CNP must be exactly 13 characters long").max(13,"CNP must be exactly 13 characters long").required("age is required"),name:I.b().min(5,"Minumum 5 characters").max(20,"Maximum 20 characters").matches(/\s/,"Write down all of your names").required("Name is a required field!"),email:I.b().email("Invalid email!").required("Email is required")}),onSubmit:function(c){Object(b.a)(u.a.mark((function r(){var s,i,l;return u.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s={seats:e,details:Object(j.a)({},c)},r.next=3,fetch("https://trains-861bd-default-rtdb.firebaseio.com/trains/"+e[0].train+"/wagons.json");case 3:return i=r.sent,r.next=6,i.json();case 6:return l=r.sent,e.forEach((function(e){l[e.wagonNumber-1].availableSeats--,l[e.wagonNumber-1].seats[e.seatNumber-1].available=!1})),r.next=10,fetch("https://trains-861bd-default-rtdb.firebaseio.com/trains/"+e[0].train+"/wagons.json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(l)});case 10:return r.sent,r.next=13,fetch("https://trains-861bd-default-rtdb.firebaseio.com/registrations/"+n+".json",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(Object(j.a)({},s))});case 13:r.sent,t(S.clearStore()),localStorage.removeItem("code"),a.replace("/");case 17:case"end":return r.stop()}}),r)})))()},children:function(e){return Object(O.jsxs)(C.a,{children:[Object(O.jsx)("h2",{children:"Book train seats"}),Object(O.jsx)(F,{label:"CNP",type:"text",name:"cnp"}),Object(O.jsx)(F,{label:"Name",type:"text",name:"name"}),Object(O.jsx)(F,{label:"E-mail",type:"email",name:"email"}),Object(O.jsxs)("div",{className:"unique",children:[Object(O.jsx)("p",{children:n}),Object(O.jsx)("button",{type:"button",onClick:c,children:"Copy to clipboard"})]}),Object(O.jsx)("button",{type:"submit",children:"Save registration"})]})}}),Object(O.jsx)("ul",{className:"seatsList",children:e.map((function(e){return Object(O.jsxs)("li",{children:[Object(O.jsx)("p",{children:e.train}),Object(O.jsxs)("p",{children:["Wagon number: ",e.wagonNumber]}),Object(O.jsx)("p",{children:e.type}),Object(O.jsxs)("p",{children:["seat nr.: ",e.seatNumber]}),Object(O.jsx)("button",{className:"deleteIcon",onClick:r.bind(null,e.id),children:Object(O.jsx)(D.a,{})})]})}))})]})};var J=function(){var e=Object(i.c)((function(e){return e})),t=Object(s.g)();return Object(O.jsx)("header",{children:Object(O.jsxs)("nav",{children:["/"!==t.pathname&&Object(O.jsx)(r.b,{to:"/",children:"Back to home"}),0!==e.length&&"/checkout"!==t.pathname&&Object(O.jsx)(r.b,{to:"/checkout",replace:!0,children:"Checkout"})]})})};var P=function(){Object(i.c)((function(e){return e}));var e=Object(i.b)();return Object(m.useEffect)((function(){if(localStorage.getItem("seats")){var t=JSON.parse(localStorage.getItem("seats"));e(S.populateStore(t))}}),[]),Object(O.jsxs)(r.a,{children:[Object(O.jsx)(J,{}),Object(O.jsxs)(s.c,{children:[Object(O.jsx)(s.a,{path:"/",exact:!0,children:Object(O.jsx)(h,{})}),Object(O.jsx)(s.a,{path:"/trains/:trainID",exact:!0,children:Object(O.jsx)(w,{})}),Object(O.jsx)(s.a,{path:"/checkout",ex:!0,children:Object(O.jsx)(q,{})})]})]})};c.a.render(Object(O.jsx)(i.a,{store:g,children:Object(O.jsx)(P,{})}),document.getElementById("root"))}},[[428,1,2]]]);
//# sourceMappingURL=main.76a5e0cb.chunk.js.map